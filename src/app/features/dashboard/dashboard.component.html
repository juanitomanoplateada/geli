<section class="dashboard-layout">
  <button class="dashboard-toggle" (click)="toggleSidebar()">☰</button>

  <nav class="dashboard-sidebar" [class.open]="sidebarOpen">
    <div class="dashboard-logo">
      <img src="/logo_incitema.png" alt="Logo INCITEMA" />
    </div>

    <a
      routerLink="/dashboard/home"
      class="dashboard-link"
      [class.active]="isExactActive('/dashboard/home')"
      >Inicio</a
    >

    <div
      *ngIf="hasRole(['AUTHORIZED-USER'])"
      class="dashboard-group"
      [class.active]="isActive('/dashboard/sessions')"
    >
      <div class="dashboard-link" (click)="toggleSubmenu('sessions')">
        Sesiones
        <span class="arrow" [class.open]="isSubmenuOpen('sessions')">▼</span>
      </div>
      <div class="dashboard-submenu" [class.open]="isSubmenuOpen('sessions')">
        <a
          routerLink="/dashboard/sessions/register-session"
          [class.active]="isActive('/dashboard/sessions/register-session')"
          >Registrar Uso</a
        >
        <a
          routerLink="/dashboard/sessions/personal-session-history"
          [class.active]="
            isActive('/dashboard/sessions/personal-session-history')
          "
          >Historial</a
        >
      </div>
    </div>

    <div
      *ngIf="hasRole(['QUALITY-ADMIN-USER'])"
      class="dashboard-group"
      [class.active]="isActive('/dashboard/users')"
    >
      <div class="dashboard-link" (click)="toggleSubmenu('users')">
        Usuarios
        <span class="arrow" [class.open]="isSubmenuOpen('users')">▼</span>
      </div>
      <div class="dashboard-submenu" [class.open]="isSubmenuOpen('users')">
        <a
          routerLink="/dashboard/users/search-user"
          [class.active]="isActive('/dashboard/users/search-user')"
          >Buscar Usuario</a
        >
        <a
          routerLink="/dashboard/users/register-user"
          [class.active]="isActive('/dashboard/users/register-user')"
          >Registrar Usuario</a
        >
      </div>
    </div>

    <div
      *ngIf="hasRole(['QUALITY-ADMIN-USER'])"
      class="dashboard-group"
      [class.active]="isActive('/dashboard/laboratories')"
    >
      <div class="dashboard-link" (click)="toggleSubmenu('laboratories')">
        Laboratorios
        <span class="arrow" [class.open]="isSubmenuOpen('laboratories')"
          >▼</span
        >
      </div>
      <div
        class="dashboard-submenu"
        [class.open]="isSubmenuOpen('laboratories')"
      >
        <a
          routerLink="/dashboard/laboratories/search-laboratory"
          [class.active]="isActive('/dashboard/laboratories/search-laboratory')"
          >Buscar Laboratorio</a
        >
        <a
          routerLink="/dashboard/laboratories/register-laboratory"
          [class.active]="
            isActive('/dashboard/laboratories/register-laboratory')
          "
          >Registrar Laboratorio</a
        >
      </div>
    </div>

    <div
      *ngIf="hasRole(['QUALITY-ADMIN-USER'])"
      class="dashboard-group"
      [class.active]="isActive('/dashboard/equipments-patterns')"
    >
      <div
        class="dashboard-link"
        (click)="toggleSubmenu('equipments-patterns')"
      >
        Equipos / Patrones
        <span class="arrow" [class.open]="isSubmenuOpen('equipments-patterns')"
          >▼</span
        >
      </div>
      <div
        class="dashboard-submenu"
        [class.open]="isSubmenuOpen('equipments-patterns')"
      >
        <a
          routerLink="/dashboard/equipments-patterns/search-equipment-pattern"
          [class.active]="
            isActive('/dashboard/equipments-patterns/search-equipment-pattern')
          "
          >Buscar Equipo / Patrón</a
        >
        <a
          routerLink="/dashboard/equipments-patterns/register-equipment-pattern"
          [class.active]="
            isActive(
              '/dashboard/equipments-patterns/register-equipment-pattern'
            )
          "
          >Registrar Equipo / Patrón</a
        >
      </div>
    </div>

    <a
      *ngIf="hasRole(['QUALITY-ADMIN-USER'])"
      routerLink="/dashboard/assign-equipment-permissions"
      class="dashboard-link"
      [class.active]="isExactActive('/dashboard/assign-equipment-permissions')"
      >Permisos de Uso</a
    >

    <a
      *ngIf="hasRole(['QUALITY-ADMIN-USER'])"
      routerLink="/dashboard/sessions/session-history"
      class="dashboard-link"
      [class.active]="isExactActive('/dashboard/sessions/session-history')"
      >Historial de Sesiones</a
    >

    <a
      *ngIf="hasRole(['QUALITY-ADMIN-USER'])"
      routerLink="/dashboard/reports/session-report"
      class="dashboard-link"
      [class.active]="isExactActive('/dashboard/reports/session-report')"
      >Reporte de Sesiones</a
    >

    <!--<div
      *ngIf="hasRole(['QUALITY-ADMIN-USER'])"
      class="dashboard-group"
      [class.active]="isActive('/dashboard/reports')"
    >
      <div class="dashboard-link" (click)="toggleSubmenu('reports')">
        Reportes
        <span class="arrow" [class.open]="isSubmenuOpen('reports')">▼</span>
      </div>
      <div class="dashboard-submenu" [class.open]="isSubmenuOpen('reports')">
        <a
          routerLink="/dashboard/reports/user-report"
          [class.active]="isActive('/dashboard/reports/user-report')"
          >Reporte de Usuarios</a
        >
        <a
          routerLink="/dashboard/reports/laboratory-report"
          [class.active]="isActive('/dashboard/reports/laboratory-report')"
          >Reporte de Laboratorios</a
        >
        <a
          routerLink="/dashboard/reports/lab-equipment-report"
          [class.active]="isActive('/dashboard/reports/lab-equipment-report')"
          >Reporte de Equipos / Patrones por Laboratorio</a
        >
        <a
          routerLink="/dashboard/reports/equipment-pattern-report"
          [class.active]="
            isActive('/dashboard/reports/equipment-pattern-report')
          "
          >Reporte de Equipos / Patrones</a
        >
        <a
          routerLink="/dashboard/reports/session-report"
          [class.active]="isActive('/dashboard/reports/session-report')"
          >Reporte de Sesiones</a
        >
      </div>
    </div>-->

    <a
      routerLink="/dashboard/user-profile"
      class="dashboard-link"
      [class.active]="isExactActive('/dashboard/user-profile')"
      >Perfil de Usuario</a
    >
    <a (click)="logout()" class="dashboard-link">Cerrar Sesión</a>
  </nav>

  <main class="dashboard-main">
    <header class="dashboard-header">
      <span class="dashboard-user-info">
        {{ username.toUpperCase() }} - {{ getTranslatedRole() }}
      </span>
    </header>

    <router-outlet></router-outlet>
  </main>
</section>
