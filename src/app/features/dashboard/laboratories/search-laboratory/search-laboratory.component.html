<div class="search-container">
  <!-- B煤squeda principal -->
  <div class="search-bar">
    <input
      type="text"
      [(ngModel)]="searchQuery"
      (keyup)="onKeyUp($event)"
      placeholder="Buscar por nombre o descripci贸n..."
      class="search-input"
      [disabled]="isLoading"
    />

    <button
      (click)="performSearch()"
      class="search-button"
      [disabled]="isLoading"
    >
      <span class="search-icon"></span>
      <span *ngIf="!isLoading">Buscar</span>
      <span *ngIf="isLoading">Buscando...</span>
    </button>

    <button
      (click)="toggleAdvancedSearch()"
      class="advanced-search-btn"
      [disabled]="isLoading"
    >
      {{ showAdvancedSearch ? "Ocultar filtros" : "B煤squeda avanzada" }}
    </button>
  </div>

  <!-- Filtros avanzados -->
  <div *ngIf="showAdvancedSearch" class="advanced-search">
    <!-- Filtro: Disponibilidad -->
    <div class="filter-group">
      <label for="availabilityFilter">Disponibilidad:</label>
      <select
        id="availabilityFilter"
        [(ngModel)]="filters.availability"
        (change)="performSearch()"
        [disabled]="isLoading"
      >
        <option value="">Todas</option>
        <option value="Disponible">Disponible</option>
        <option value="No disponible">No disponible</option>
      </select>
    </div>

    <!-- Filtro: Ubicaci贸n con buscador embebido -->
    <div class="filter-group">
      <label>Ubicaci贸n:</label>
      <app-dropdown-filter
        [options]="availableLocations"
        [selected]="filters.location"
        [placeholder]="'Seleccione ubicaci贸n...'"
        [allowEmpty]="'Todas'"
        (selectedChange)="onLocationChange($event)"
      ></app-dropdown-filter>
    </div>

    <button
      (click)="clearFilters()"
      class="clear-filters-btn"
      [disabled]="isLoading"
    >
      Limpiar filtros
    </button>
  </div>

  <!-- Estado de carga -->
  <div *ngIf="isLoading" class="loading-state">
    <div class="spinner"></div>
    <p>Buscando laboratorios...</p>
  </div>

  <!-- Resultados -->
  <div *ngIf="!isLoading && laboratories.length > 0" class="results-container">
    <h3>Resultados ({{ laboratories.length }})</h3>
    <div class="results-grid">
      <div class="results-header">
        <div>Nombre</div>
        <div>Descripci贸n</div>
        <div>Disponibilidad</div>
        <div>Ubicaci贸n</div>
        <div>Acciones</div>
      </div>

      <div
        *ngFor="let lab of laboratories; trackBy: trackById"
        class="result-item"
      >
        <div data-label="Nombre">{{ lab.laboratoryName }}</div>
        <div data-label="Descripci贸n">{{ lab.laboratoryDescription }}</div>
        <div data-label="Disponibilidad">
          {{ lab.laboratoryAvailability ? "Disponible" : "No disponible" }}
        </div>
        <div data-label="Ubicaci贸n">
          {{ lab.location?.locationName || "-" }}
        </div>
        <div data-label="Acciones">
          <button class="search-button" (click)="navigateToEdit(lab.id)">
            Editar
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Sin resultados -->
  <div
    *ngIf="!isLoading && searchQuery && laboratories.length === 0"
    class="no-results"
  >
    <p>No se encontraron laboratorios para "{{ searchQuery }}"</p>
    <button (click)="clearFilters()" class="try-again-btn">
      Limpiar b煤squeda
    </button>
  </div>
</div>
