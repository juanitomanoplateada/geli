<div class="user-profile-container">
  <div class="profile-card">
    <h1>Perfil de Usuario</h1>

    <!-- Sección de datos personales -->
    <div class="profile-section">
      <h3>Información Personal</h3>
      <div class="profile-data-grid">
        <div class="profile-data-row">
          <span class="data-label">Nombre Completo:</span>
          <span class="data-value">{{ userProfile.fullName }}</span>
        </div>
        <div class="profile-data-row">
          <span class="data-label">Identificación:</span>
          <span class="data-value">{{ userProfile.userId }}</span>
        </div>
        <div class="profile-data-row">
          <span class="data-label">Correo Institucional:</span>
          <span class="data-value">{{ userProfile.institutionalEmail }}</span>
        </div>
        <div class="profile-data-row">
          <span class="data-label">Estado del Perfil:</span>
          <span class="data-value">{{ userProfile.userStatus }}</span>
        </div>
        <div class="profile-data-row">
          <span class="data-label">Rol:</span>
          <span class="data-value">{{ userProfile.role }}</span>
        </div>
      </div>
    </div>

    <!-- Sección para cambio de contraseña -->
    <div class="profile-section">
      <h3>Cambio de Contraseña</h3>
      <form
        class="password-change-form"
        (ngSubmit)="changePassword()"
        #changePasswordForm="ngForm"
      >
        <!-- Contraseña actual -->
        <div class="form-group">
          <label for="currentPassword" class="form-label"
            >Contraseña Actual:</label
          >
          <div class="password-wrapper">
            <input
              [type]="showCurrentPassword ? 'text' : 'password'"
              id="currentPassword"
              class="form-input password-field"
              name="currentPassword"
              [(ngModel)]="currentPassword"
              (input)="onCurrentPasswordInput()"
              placeholder="Ingrese la contraseña actual"
              required
            />
            <span
              class="toggle-icon"
              (click)="togglePasswordVisibility('current')"
            >
              {{ showCurrentPassword ? "🙈" : "👁️" }}
            </span>
          </div>
        </div>

        <!-- Nueva contraseña y confirmación (se muestran si hay algo ingresado en la actual) -->
        <div *ngIf="currentPassword.trim()">
          <div class="form-group">
            <label for="newPassword" class="form-label"
              >Nueva Contraseña:</label
            >
            <div class="password-wrapper">
              <input
                [type]="showNewPassword ? 'text' : 'password'"
                id="newPassword"
                class="form-input password-field"
                name="newPassword"
                [(ngModel)]="newPassword"
                (input)="validatePasswordForm()"
                placeholder="Ingrese la nueva contraseña"
                required
              />
              <span
                class="toggle-icon"
                (click)="togglePasswordVisibility('new')"
              >
                {{ showNewPassword ? "🙈" : "👁️" }}
              </span>
            </div>
            <div
              *ngIf="newPassword && !isNewPasswordValid"
              class="error-message"
            >
              La contraseña debe tener al menos 8 caracteres, una mayúscula, una
              minúscula, un número y un carácter especial.
            </div>
          </div>

          <div class="form-group">
            <label for="confirmPassword" class="form-label"
              >Confirmar Nueva Contraseña:</label
            >
            <div class="password-wrapper">
              <input
                [type]="showConfirmPassword ? 'text' : 'password'"
                id="confirmPassword"
                class="form-input password-field"
                name="confirmPassword"
                [(ngModel)]="confirmPassword"
                (input)="validatePasswordForm()"
                placeholder="Confirme la nueva contraseña"
                required
              />
              <span
                class="toggle-icon"
                (click)="togglePasswordVisibility('confirm')"
              >
                {{ showConfirmPassword ? "🙈" : "👁️" }}
              </span>
            </div>
            <div
              *ngIf="confirmPassword && newPassword !== confirmPassword"
              class="error-message"
            >
              Las contraseñas no coinciden.
            </div>
          </div>
        </div>

        <!-- Botón de acción -->
        <button
          class="submit-btn"
          type="submit"
          [disabled]="!canSubmitPasswordChange"
        >
          Cambiar Contraseña
        </button>

        <!-- Mensaje de éxito o error -->
        <div
          *ngIf="feedbackMessage"
          [ngClass]="
            passwordChangeSuccessful
              ? 'feedback-message success'
              : 'feedback-message error'
          "
        >
          {{ feedbackMessage }}
        </div>
      </form>
    </div>
  </div>
</div>
