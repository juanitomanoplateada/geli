<div class="laboratory-report-wrapper">
  <!-- Panel de exportaciÃ³n con tÃ­tulo -->
  <div class="export-panel">
    <h1 class="report-title">ğŸ¢ Reporte de Laboratorios</h1>
    <div class="export-buttons">
      <button class="btn-excel" (click)="exportToExcel()">ğŸ“Š Excel</button>
      <button class="btn-csv" (click)="exportToCSV()">ğŸ“„ CSV</button>
      <button class="btn-pdf" (click)="exportToPDF()">ğŸ§¾ PDF</button>
    </div>
  </div>

  <!-- Filtros -->
  <div class="summary-panel filter-panel">
    <h3 class="section-title full-width">ğŸ” Filtros de BÃºsqueda</h3>

    <label>
      Disponibilidad:
      <select
        [(ngModel)]="selectedAvailability"
        (change)="filterLaboratories()"
      >
        <option value="">Todas</option>
        <option *ngFor="let option of availabilityOptions" [value]="option">
          {{ option }}
        </option>
      </select>
    </label>

    <label>
      UbicaciÃ³n:
      <app-dropdown-filter
        [options]="locationOptions"
        [selected]="selectedLocation"
        (selectedChange)="onLocationChange($event)"
        placeholder="Seleccione ubicaciÃ³n"
        allowEmpty="Todas"
      />
    </label>

    <label>
      MÃ­n. Equipos:
      <input
        type="number"
        [(ngModel)]="minEquipmentCount"
        (change)="filterLaboratories()"
        placeholder="MÃ­n."
        min="0"
      />
    </label>

    <label>
      MÃ¡x. Equipos:
      <input
        type="number"
        [(ngModel)]="maxEquipmentCount"
        (change)="filterLaboratories()"
        placeholder="MÃ¡x."
        min="0"
      />
    </label>

    <button (click)="resetFilters()">Limpiar Filtros</button>
  </div>

  <!-- EstadÃ­sticas -->
  <div class="summary-panel statistics-panel">
    <h3 class="section-title">ğŸ“Œ EstadÃ­sticas Generales</h3>

    <div class="stats-row">
      <div class="stat-box green">
        <h4>âœ… Disponible</h4>
        <p>{{ getChartValue(availabilityChart, 0) }}</p>
      </div>
      <div class="stat-box red">
        <h4>âŒ Ocupado</h4>
        <p>{{ getChartValue(availabilityChart, 1) }}</p>
      </div>
      <div class="stat-box neutral">
        <h4>ğŸ·ï¸ Total</h4>
        <p>{{ filteredLaboratories.length }}</p>
      </div>
    </div>
  </div>

  <!-- Tabla y grÃ¡ficas en la misma fila -->
  <div class="main-content">
    <!-- Tabla -->
    <div class="left-column">
      <div class="table-section">
        <h3 class="section-title">ğŸ“‹ Lista de Laboratorios</h3>
        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th>Nombre</th>
              <th>DescripciÃ³n</th>
              <th>Disponibilidad</th>
              <th>UbicaciÃ³n</th>
              <th>Equipos</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let lab of filteredLaboratories">
              <td data-label="ID">{{ lab.id }}</td>
              <td data-label="Nombre">{{ lab.name }}</td>
              <td data-label="DescripciÃ³n">{{ lab.description }}</td>
              <td data-label="Disponibilidad">{{ lab.availability }}</td>
              <td data-label="UbicaciÃ³n">
                {{ lab.location.building }} - Piso {{ lab.location.floor }}
              </td>
              <td data-label="Equipos">{{ lab.equipment.length }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- GrÃ¡ficas -->
    <div class="right-column">
      <div class="chart-tabs">
        <h3 class="section-title">ğŸ“ˆ Visualizaciones GrÃ¡ficas</h3>
        <div class="tab-buttons">
          <button
            [class.active]="activeTab === 'availability'"
            (click)="activeTab = 'availability'"
          >
            Disponibilidad
          </button>
          <button
            [class.active]="activeTab === 'location'"
            (click)="activeTab = 'location'"
          >
            UbicaciÃ³n
          </button>
          <button
            [class.active]="activeTab === 'equipment'"
            (click)="activeTab = 'equipment'"
          >
            Equipos por Laboratorio
          </button>
        </div>

        <div class="tab-content" *ngIf="isBrowser">
          <canvas
            baseChart
            [data]="availabilityChart"
            [type]="'pie'"
            [legend]="true"
            class="chart"
            [class.hidden]="activeTab !== 'availability'"
          ></canvas>
          <canvas
            baseChart
            [data]="equipmentChart"
            [type]="'bar'"
            [legend]="true"
            class="chart"
            [class.hidden]="activeTab !== 'equipment'"
          ></canvas>
          <canvas
            baseChart
            [data]="locationChart"
            [type]="'pie'"
            [legend]="true"
            class="chart"
            [class.hidden]="activeTab !== 'location'"
          ></canvas>
        </div>
      </div>
    </div>
  </div>
</div>
