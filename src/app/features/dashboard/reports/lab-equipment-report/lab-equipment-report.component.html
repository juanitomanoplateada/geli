<div class="lab-equipment-report-wrapper">
  <!-- Vista de selección de laboratorio -->
  <div class="lab-selector" *ngIf="!selectedLab">
    <h1 class="report-title">📊 Reporte de Equipos por Laboratorio</h1>

    <input
      type="text"
      [(ngModel)]="labSearchTerm"
      placeholder="Buscar laboratorio..."
      class="search-input"
    />

    <div class="lab-list">
      <div
        class="lab-card"
        *ngFor="let lab of filteredLaboratoriesFilteredBySearch()"
        (click)="selectLaboratory(lab)"
      >
        <h3>{{ lab.name }}</h3>
        <p><strong>Ubicación:</strong> {{ lab.location }}</p>
        <p><strong>Disponibilidad:</strong> {{ lab.availability }}</p>
        <p><strong>Equipos:</strong> {{ lab.equipment.length }}</p>
      </div>
    </div>
  </div>

  <!-- Vista detallada de laboratorio -->
  <div *ngIf="selectedLab" class="lab-detail-container">
    <!-- Panel de exportación con título -->
    <div class="export-panel">
      <h1 class="report-title">📊 Reporte de Equipos por Laboratorio</h1>
      <div class="export-buttons">
        <button (click)="resetLabSelection()">← Volver</button>
        <button class="btn-excel" (click)="exportToExcel()">📊 Excel</button>
        <button class="btn-csv" (click)="exportToCSV()">📄 CSV</button>
        <button class="btn-pdf" (click)="exportToPDF()">🧾 PDF</button>
      </div>
    </div>

    <!-- Info del laboratorio -->
    <div class="lab-detail-row">
      <div class="lab-info">
        <h2>{{ selectedLab.name }}</h2>
        <p><strong>Ubicación:</strong> {{ selectedLab.location }}</p>
        <p><strong>Disponibilidad:</strong> {{ selectedLab.availability }}</p>
        <p><strong>Total Equipos:</strong> {{ filteredEquipment.length }}</p>
      </div>
    </div>

    <!-- Estadísticas -->
    <div class="summary-panel statistics-panel">
      <h3 class="section-title">📌 Estadísticas Generales</h3>
      <div class="stats-row">
        <div class="stat-box green">
          <h4>✅ Disponible</h4>
          <p>{{ getChartValue(availabilityChart, 0) }}</p>
        </div>
        <div class="stat-box red">
          <h4>❌ Ocupado</h4>
          <p>{{ getChartValue(availabilityChart, 1) }}</p>
        </div>
        <div class="stat-box neutral">
          <h4>📦 Total</h4>
          <p>{{ filteredEquipment.length }}</p>
        </div>
      </div>
    </div>

    <!-- Contenido principal: tabla + gráficas -->
    <div class="report-content">
      <!-- Tabla -->
      <div class="table-section">
        <h3 class="section-title">📋 Lista de Equipos</h3>
        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th>Nombre</th>
              <th>Marca</th>
              <th>N° Inventario</th>
              <th>Disponibilidad</th>
              <th>Función</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let eq of filteredEquipment">
              <td data-label="ID">{{ eq.id }}</td>
              <td data-label="Nombre">{{ eq.name }}</td>
              <td data-label="Marca">{{ eq.brand }}</td>
              <td data-label="N° Inventario">{{ eq.inventoryNumber }}</td>
              <td data-label="Disponibilidad">{{ eq.availability }}</td>
              <td data-label="Función">{{ eq.function }}</td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Gráficas -->
      <div class="chart-section" *ngIf="isBrowser">
        <h3 class="section-title">📈 Visualizaciones</h3>
        <div class="tab-buttons">
          <button
            [class.active]="activeTab === 'availability'"
            (click)="activeTab = 'availability'"
          >
            Disponibilidad
          </button>
          <button
            [class.active]="activeTab === 'function'"
            (click)="activeTab = 'function'"
          >
            Función
          </button>
        </div>

        <div class="tab-content">
          <canvas
            *ngIf="activeTab === 'availability'"
            #availabilityChartCanvas
            baseChart
            [data]="availabilityChart"
            [type]="'pie'"
            [legend]="true"
            class="chart"
          ></canvas>
          <canvas
            *ngIf="activeTab === 'function'"
            #functionChartCanvas
            baseChart
            [data]="functionChart"
            [type]="'bar'"
            [legend]="true"
            class="chart"
          ></canvas>
        </div>
      </div>
    </div>
  </div>
</div>
